@model ObjPhatTu

<div class="content">
    <div class="title-page">
        Quản lý phât tử
    </div>
    <div class="search">
        <div class="title-search">Tìm kiếm phật tử</div>
        <form>
            <div class="filter">
                <div class="item-filter">
                    <label class="name-filter" name="name">Tên</label>
                    <input name="name" />
                </div>
                <div class="item-filter">
                    <label class="name-filter">Pháp danh</label>
                    <input name="phapdanh"/>
                </div>
                <div class="item-filter">
                    <label class="name-filter">Email</label>
                    <input name="emali"/>
                </div>
                <div class="item-filter">
                    <label class="name-filter">Giới tính</label>
                    <select name="gioitinh" style="width: 100%">
                        <option disabled selected>Chọn giới tính</option>
                        <option value="1">Nam</option>
                        <option value="0">Nữ</option>
                    </select>
                </div>
                <div class="item-filter">
                    <label class="name-filter">Trạng thái phật tử</label>
                    <input />
                </div>
            </div>
            <div class="btn-box">
                <button class="button" type="submit">
                    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512">
                        <path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z" />
                    </svg>
                </button>
                <div class="button btn-create"">
                    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512">
                        <path d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z" />
                    </svg>
                </div>
            </div>
        </form> 
        <div class="show-view" id="show-create">
            <div class="bg-show"></div>
            <div class="container-view">
                <form class="form-create" method="post" asp-area="" asp-controller="QuanLyPhatTu" asp-action="Create">
                    <div class="title-form">Thêm phật tử</div>
                    <input type="hidden" name="PhatTuId" id="phatTuId" value="">
                    <div class="info">
                        <div class="item-info col-3">
                            <label class="name-info">Họ</label>
                            <input type="text" placeholder="Nhập họ tên" name="Ho" id="ho" value="" required />
                        </div>
                        <div class="item-info col-3">
                            <label class="name-info">Tên đệm</label>
                            <input type="text" placeholder="Nhập họ tên" name="TenDem" id="tenDem" value="" />
                        </div>
                        <div class="item-info col-3">
                            <label class="name-info">Tên</label>
                            <input type="text" placeholder="Nhập họ tên" name="Ten" id="ten" value="" required/>
                        </div>
                        <div class="item-info">
                            <label class="name-info">Pháp Danh</label>
                            <input type="text" placeholder="Nhập pháp danh" name="PhapDanh" id="phapDanh" />
                        </div>
                        <div class="item-info">
                            <label class="name-info">Chùa</label>
                            <select name="ChuaId" id="chuaId" required>
                                <option disabled selected>Chọn chùa</option>
                                @foreach(var chua in Model.ListChua)
                                {
                                    <option value="@chua.Id" >@chua.Name</option>
                                }
                            </select>
                        </div>
                        <div class="item-info">
                            <label class="name-info">Email</label>
                            <input type="text" placeholder="Nhập email" name="Email" id="email" required/>
                        </div>
                        <div class="item-info">
                            <label class="name-info">Mật khẩu</label>
                            <input type="text" placeholder="Nhập mật khẩu" name="PassWord" id="password" required/>
                        </div>
                        <div class="item-info">
                            <label class="name-info">Số điện thoại</label>
                            <input type="text" placeholder="Nhập số điện thoại" name="SoDienThoai" id="soDienThoai" />
                        </div>
                        <div class="item-info">
                            <label class="name-info">Ngày sinh</label>
                            <input type="text" name="Ngaysinh" id="ngaySinh" placeholder="Nhập ngày" onfocus="(this.type='date')" onblur="if(this.value==''){this.type='text'}" />
                        </div>
                        <div class="item-info">
                            <label class="name-info">Ngày xuất gia</label>
                            <input type="text" name="NgayXuatGia" id="ngayXuatGia" placeholder="Nhập ngày" onfocus="(this.type='date')" onblur="if(this.value==''){this.type='text'}" />
                        </div>
                        <div class="item-info">
                            <label class="name-info">Kiểu thành viên</label>
                            <select name="KieuThanhVienId" id="kieuThanhVienId" required>
                                <option disabled selected>Chọn kiểu thành viên</option>
                                @foreach (var chua in Model.ListChua)
                                {
                                    <option value="@chua.Id">@chua.Name</option>
                                }
                            </select>
                        </div>
                        <div class="item-info col-3">
                            <label class="name-info">Giới tính</label>
                            <select name="GioiTinh" id="gioiTinh" required>
                                <option disabled selected>Chọn giới tính</option>
                                <option value="1">Nam</option>
                                <option value="0">Nữ</option>
                            </select>
                        </div>
                        <div class="item-info col-3">
                            <label class="name-info">Hoàn tục</label>
                            <input type="text" placeholder="Chưa có" name="DaHoanTuc" id="daHoanTuc" />
                        </div>
                        <div class="item-info col-3">
                            <label class="name-info">Ngày hoàn tục</label>
                            <input type="text" placeholder="Nhập ngày" name="NgayHoanTuc" id="ngayHoanTuc" onfocus="(this.type='date')" onblur="if(this.value==''){this.type='text'}" />
                        </div>
                    </div>
                    <div class="area-btn">
                        <button type="submit" class="btn-ok">Thêm phật tử</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="list-data">
        <div class="show-view" id="show-view">
            <div class="bg-show"></div>
            <div class="container-view">
                <div class="form-view">
                    <div class="title-form">Thông tin phật tử</div>
                    <input type="hidden" name="PhatTuId" id="PhatTuId" value="">
                    <div class="avatar" id="AnhChup" style="padding-left: 16px; padding-right: 16px; width: 120px; height: 120px; box-sizing:content-box;">
                        <img src="" />
                    </div>
                    <div class="info">
                        <div class="item-info">
                            <label class="name-info">Họ tên</label>
                            <input type="text" placeholder="Chưa có" name="Ten" id="Ten" value="" disabled />
                        </div>
                        <div class="item-info">
                            <label class="name-info">Pháp Danh</label>
                            <input type="text" placeholder="Chưa có" name="PhapDanh" id="PhapDanh" disabled />
                        </div>
                        <div class="item-info">
                            <label class="name-info">Email</label>
                            <input type="text" placeholder="Chưa có" name="Email" id="Email" disabled />
                        </div>
                        <div class="item-info">
                            <label class="name-info">Số điện thoại</label>
                            <input type="text" placeholder="Chưa có" name="SoDienThoai" id="SoDienThoai" disabled />
                        </div>
                        <div class="item-info">
                            <label class="name-info">Ngày sinh</label>
                            <input type="text" name="Ngaysinh" id="NgaySinh" placeholder="Chưa có" onfocus="(this.type='date')" onblur="if(this.value==''){this.type='text'}" disabled />
                        </div>
                        <div class="item-info">
                            <label class="name-info">Ngày xuất gia</label>
                            <input type="text" name="NgayXuatGia" id="NgayXuatGia" placeholder="Chưa có" onfocus="(this.type='date')" onblur="if(this.value==''){this.type='text'}" disabled />
                        </div>
                        <div class="item-info col-3">
                            <label class="name-info">Giới tính</label>
                            <input type="text" name="GioiTinh" id="GioiTinh" disabled />
                        </div>
                        <div class="item-info col-3">
                            <label class="name-info">Hoàn tục</label>
                            <input type="text" placeholder="Chưa có" name="DaHoanTuc" id="DaHoanTuc" disabled />
                        </div>
                        <div class="item-info col-3">
                            <label class="name-info">Ngày hoàn tục</label>
                            <input type="text" placeholder="Chưa có" name="NgayHoanTuc" id="NgayHoanTuc" onfocus="(this.type='date')" onblur="if(this.value==''){this.type='text'}" disabled />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="filter-data">
            <form method="get" asp-controller="QuanLyPhatTu" asp-action="Index">
                <select name="PageSize" id="PageSize" onchange="form.submit()">
                    <option selected>Hiển thị @Model.ListPhatTu.Data.ToList().Count() trên @Model.ListPhatTu.Pagination.TotalCount</option>
                    <option value="5" >Hiển thị 5</option>
                    
                    <option value="10">Hiển thị 10</option>
                </select>
            </form>
        </div>
        <table>
            
            <thead>
                <tr style="height: 40px">
                    <th>
                    </th>
                    <th style="width: 35%">
                        Phật tử
                    </th>
                    <th style="width: 20%">
                        Ngày xuất gia
                    </th>
                    <th style="width: 20%">
                        Số điện thoại
                    </th>
                    <th style="width: 25%">
                        Số buổi đạo tràng đã tham gia
                    </th>
                    <th>
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach(var phattu in Model.ListPhatTu.Data)
                {
                    <tr>
                        <td>
                            <div class="view-info" id="pt-@phattu.PhatTuId" data-phattuid="@phattu.PhatTuId" data-ten="@phattu.Ten" data-anhchup="@phattu.AnhChup"
                                data-phapdanh="@phattu.PhapDanh" data-email="@phattu.Email" data-sodienthoai="@phattu.SoDienThoai" data-ngaysinh="@phattu.NgaySinh"
                                data-ngayxuatgia="@phattu.NgayXuatGia" data-gioitinh="@phattu.GioiTinh" data-dahoantuc="@phattu.DaHoanTuc" data-ngayhoantuc="@phattu.NgayHoanTuc"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512">
                                <path d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z" />
                                </svg>
                            </div>
                        </td>
                        <td style="text-align: left!important">
                            <div style="display: flex; align-items: center; padding: 5px 0;">
                                <div class="avatar">
                                    @{
                                        if (phattu.AnhChup == null)
                                        {
                                            <img src="https://i1.wp.com/www.prairiebus.com/wp-content/uploads/2020/11/421-4212617_person-placeholder-image-transparent-hd-png-download.png?resize=768%2C734">
                                        }
                                        else
                                        {
                                            <img src="@phattu.AnhChup">
                                        }
                                    }
                                </div>
                                <div class="name-email">
                                    <div>@{ var hoten2 = phattu.Ho + " " + phattu.TenDem + " " + phattu.Ten; @hoten2.ToUpper()}</div>
                                    <div>@phattu.Email</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            @{
                                string ngayxuatgia = "Null";
                                if (phattu.NgayXuatGia.HasValue)
                                {
                                    ngayxuatgia = ((DateTime)phattu.NgayXuatGia).ToString("dd/MM/yyyy");
                                }
                            }
                            @ngayxuatgia
                        </td>
                        <td>
                            @{
                                string sodienthoai = "Null";
                                if (!string.IsNullOrEmpty(phattu.SoDienThoai))
                                {
                                    sodienthoai = phattu.SoDienThoai;
                                }
                            }
                            @sodienthoai
                        </td>
                        <td>@phattu.Dondangkys.ToList().Count()</td>
                        <td>
                            <div class="edit-info" id="edit-info" id="pt-@phattu.PhatTuId" data-phattuid="@phattu.PhatTuId" data-ten="@phattu.Ten" data-ho="@phattu.Ho" data-tendem="@phattu.TenDem" data-anhchup="@phattu.AnhChup"
                                 data-phapdanh="@phattu.PhapDanh" data-email="@phattu.Email" data-sodienthoai="@phattu.SoDienThoai" data-ngaysinh="@phattu.NgaySinh" data-chuaid="@phattu.ChuaId" data-kieuthanhvienid="@phattu.KieuThanhVienId"
                                 data-ngayxuatgia="@phattu.NgayXuatGia" data-gioitinh="@phattu.GioiTinh" data-dahoantuc="@phattu.DaHoanTuc" data-ngayhoantuc="@phattu.NgayHoanTuc">
                                <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512">
                                    <path d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z" />
                                </svg>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>        
        </table>
        @if(Model.ListPhatTu.Pagination.TotalPage > 1)
        {
            <div class="pagination-ct">
                <ul>
                    <li class="page-item @(Model.ListPhatTu.Pagination.PageNumber == 1 ? "disabled" : "")">
                        <a class="page-link" href="#" aria-label="Previous" data-page-number="@{ var a = Model.ListPhatTu.Pagination.PageNumber - 1; @a}" data-page-size="@Model.ListPhatTu.Pagination.PageSize">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                        </a>
                    </li>
                    @for (int i = 1; i <= @Model.ListPhatTu.Pagination.TotalPage; i++)
                    {
                        <li class="page-item @(i == Model.ListPhatTu.Pagination.PageNumber ? "active" : "")">
                            <a class="page-link" href="#" data-page-number="@i" data-page-size="@Model.ListPhatTu.Pagination.PageSize" style="cursor: pointer">@i</a>
                        </li>
                    }
                    <li class="page-item @(Model.ListPhatTu.Pagination.PageNumber == Model.ListPhatTu.Pagination.TotalPage ? "disabled" : "")">
                        <a class="page-link" href="#" aria-label="Next" data-page-number="@{ var next = Model.ListPhatTu.Pagination.PageNumber + 1; @next}" data-page-size="@Model.ListPhatTu.Pagination.PageSize">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                        </a>
                    </li>
                </ul>
            </div>
        }    
    </div>
    <div class="show-view" id="show-edit">
        <div class="bg-show"></div>
        <div class="container-view">
            <form class="form-create" method="post" asp-area="" asp-controller="QuanLyPhatTu" asp-action="Edit">
                <div class="title-form">Thêm phật tử</div>
                <input type="hidden" name="PhatTuId" id="e-phatTuId" value="">
                <div class="info">
                    <div class="item-info col-3">
                        <label class="name-info">Họ</label>
                        <input type="text" placeholder="Nhập họ tên" name="Ho" id="e-ho" value="" required />
                    </div>
                    <div class="item-info col-3">
                        <label class="name-info">Tên đệm</label>
                        <input type="text" placeholder="Nhập họ tên" name="TenDem" id="e-tenDem" value="" />
                    </div>
                    <div class="item-info col-3">
                        <label class="name-info">Tên</label>
                        <input type="text" placeholder="Nhập họ tên" name="Ten" id="e-ten" value="" required />
                    </div>
                    <div class="item-info">
                        <label class="name-info">Pháp Danh</label>
                        <input type="text" placeholder="Nhập pháp danh" name="PhapDanh" id="e-phapDanh" />
                    </div>
                    <div class="item-info">
                        <label class="name-info">Chùa</label>
                        <select name="ChuaId" id="e-chuaId">
                            <option disabled selected value="">Chọn chùa</option>
                            @foreach (var chua in Model.ListChua)
                            {
                                <option value="@chua.Id">@chua.Name</option>
                            }
                        </select>
                    </div>
                    <div class="item-info">
                        <label class="name-info">Email</label>
                        <input type="text" placeholder="Nhập email" name="Email" id="e-email" required />
                    </div>
                    <div class="item-info">
                        <label class="name-info">Mật khẩu mới</label>
                        <input type="text" placeholder="Nhập mật khẩu" name="PassWord" id="e-password"/>
                    </div>
                    <div class="item-info">
                        <label class="name-info">Số điện thoại</label>
                        <input type="text" placeholder="Nhập số điện thoại" name="SoDienThoai" id="e-soDienThoai" />
                    </div>
                    <div class="item-info">
                        <label class="name-info">Ngày sinh</label>
                        <input type="text" name="Ngaysinh" id="e-ngaySinh" placeholder="Nhập ngày" onfocus="(this.type='date')" onblur="if(this.value==''){this.type='text'}" />
                    </div>
                    <div class="item-info">
                        <label class="name-info">Ngày xuất gia</label>
                        <input type="text" name="NgayXuatGia" id="e-ngayXuatGia" placeholder="Nhập ngày" onfocus="(this.type='date')" onblur="if(this.value==''){this.type='text'}" />
                    </div>
                    <div class="item-info">
                        <label class="name-info">Kiểu thành viên</label>
                        <select name="KieuThanhVienId" id="e-kieuThanhVienId">
                            <option disabled selected value="">Chọn kiểu thành viên</option>
                            @foreach (var chua in Model.ListChua)
                            {
                                <option value="@chua.Id">@chua.Name</option>
                            }
                        </select>
                    </div>
                    <div class="item-info col-3">
                        <label class="name-info">Giới tính</label>
                        <select name="GioiTinh" id="e-gioiTinh" required>
                            <option disabled selected>Chọn giới tính</option>
                            <option value="1">Nam</option>
                            <option value="0">Nữ</option>
                        </select>
                    </div>
                    <div class="item-info col-3">
                        <label class="name-info">Hoàn tục</label>
                        <input type="text" placeholder="Chưa có" name="DaHoanTuc" id="e-aHoanTuc" />
                    </div>
                    <div class="item-info col-3">
                        <label class="name-info">Ngày hoàn tục</label>
                        <input type="text" placeholder="Nhập ngày" name="NgayHoanTuc" id="e-ngayHoanTuc" onfocus="(this.type='date')" onblur="if(this.value==''){this.type='text'}" />
                    </div>
                </div>
                <div class="area-btn">
                    <button type="submit" class="btn-ok">Sửa phật tử</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $(".bg-show").click(function () {
            $(".show-view").hide();
            $(".form-create")[0].reset();
            $("body").css("overflow", "unset");
        });
        $(".btn-create").click(function () {
            $("#show-create").show();
            $("body").css("overflow", "hidden");
        });
        $(".view-info").click(function () {
            // Lấy dữ liệu được gán từ view-info
            var phattuid = $(this).data('phattuid');
            var ten = $(this).data('ten');
            var email = $(this).data('email');
            var sodienthoai = $(this).data('sodienthoai');
            var ngaysinh = $(this).data('ngaysinh');
            var ngayxuatgia = $(this).data('ngayxuatgia');
            var gioitinh = $(this).data('gioitinh');
            var dahoantuc = $(this).data('dahoantuc');
            var ngayhoantuc = $(this).data('ngayhoantuc');
            var anhchup = $(this).data('anhchup');
            if (!anhchup) {
                anhchup = "https://i1.wp.com/www.prairiebus.com/wp-content/uploads/2020/11/421-4212617_person-placeholder-image-transparent-hd-png-download.png?resize=768%2C734";
            }
            if (gioitinh == 0) {
                gioitinh = "Nữ";
            } else {
                gioitinh = "Nam";
            }
            // Gán giữ liệu cho value input để show
            $("#PhatTuId").val(phattuid);
            $("#Ten").val(ten);
            $("#Email").val(email);
            $("#SoDienThoai").val(sodienthoai);
            $("#NgaySinh").val(ngaysinh);
            $("#NgayXuatGia").val(ngayxuatgia);
            $("#GioiTinh").val(gioitinh);
            $("#DaHoanTuc").val(dahoantuc);
            $("#NgayHoanTuc").val(ngayhoantuc);
            $("#AnhChup > img").attr("src", anhchup);
            $("body").css("overflow", "hidden");
            $("#show-view").show();
        });

        $(".edit-info").click(function () {
            // Lấy dữ liệu được gán từ view-info
            var phattuid = $(this).data('phattuid');
            var ten = $(this).data('ten');
            var tendem = $(this).data('tendem');
            var ho = $(this).data('ho');
            var email = $(this).data('email');
            var sodienthoai = $(this).data('sodienthoai');
            var ngaysinh = $(this).data('ngaysinh');
            var ngayxuatgia = $(this).data('ngayxuatgia');
            var gioitinh = $(this).data('gioitinh');
            var dahoantuc = $(this).data('dahoantuc');
            var ngayhoantuc = $(this).data('ngayhoantuc');
            var anhchup = $(this).data('anhchup');
            var chuaid = $(this).data('chuaid');
            var kieuthanhvienid = $(this).data('kieuthanhvienid');
            if (!anhchup) {
                anhchup = "https://i1.wp.com/www.prairiebus.com/wp-content/uploads/2020/11/421-4212617_person-placeholder-image-transparent-hd-png-download.png?resize=768%2C734";
            }
            if (chuaid == null) {

            }
            // Gán giữ liệu cho value input để show
            $("#e-phatTuId").val(phattuid);
            $("#e-ten").val(ten);
            $("#e-ho").val(ho);
            $("#e-tendem").val(tendem);
            $("#e-email").val(email);
            $("#e-soDienThoai").val(sodienthoai);
            $("#e-ngaySinh").val(ngaysinh);
            $("#e-ngayXuatGia").val(ngayxuatgia);
            $("#e-gioiTinh").val(gioitinh).attr("selected");
            $("#e-daHoanTuc").val(dahoantuc);
            $("#e-ngayHoanTuc").val(ngayhoantuc);
            $("#e-chuaId").val(chuaid).attr("selected");
            $("#e-kieuThanhVienId").val(kieuthanhvienid).attr("selected");
            //$("#e-anhChup > img").attr("src", anhchup);
            $("body").css("overflow", "hidden");
            $("#show-edit").show();
        });

        $(".page-link").click(function () {
            var pageNumber = $(this).data("page-number");
            var pageSize = $(this).data("page-size")

            // Gửi yêu cầu đến server với pageNumber và pageSize đã chọn
            window.location.href = "/QuanLyPhatTu?PageSize=" + pageSize + "&PageNumber=" + pageNumber;
        });
    });
</script>
